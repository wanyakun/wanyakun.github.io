(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{501:function(t,e,a){"use strict";a.r(e);var s=a(7),n=Object(s.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("p",[t._v("昨天看在"),a("a",{attrs:{href:"https://report.tingyun.com/mobile/overview/mobile",target:"_blank",rel:"noopener noreferrer"}},[t._v("听云"),a("OutboundLink")],1),t._v("上的Crash记录，看到我们App中有和视频播放相关的Crash。昨天就点了几次发现从视频播放进入产品详情，并进行商品购物下单，最后从订单详情返回到购物车的时候App Crash。操作轨迹如下：")]),t._v(" "),a("p",[a("em",[t._v("VideoViewController -> VideoDetailViewController -> ProductItemDetailViewController -> UCYWebViewController（结算页）-> PayWayViewController -> UCYWebViewController（订单详情页）-> UCYTabBarController（并选中购物车tab）-> UCYWebViewController(购物车) -> App Crash")])]),t._v(" "),a("p",[t._v("对于导致App Crash的bug我们决定是零容忍的，严重导致用户体验。下面就详细说明下此次Fix这个Crash问题的过程。")]),t._v(" "),a("h3",{attrs:{id:"crash定位"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#crash定位"}},[t._v("#")]),t._v(" Crash定位")]),t._v(" "),a("p",[t._v("首先Crash提示为EXC_BAD_ACCESS，看操作轨迹还以为我PopUtils工具类导致的，但是以前其他也有类似的返回，第一反应打断点单步调试。")]),t._v(" "),a("div",{staticClass:"language-objc line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-objc"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("popToRootViewControllerWithSelectedIndex"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("NSInteger"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("index "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    UITabBarController "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("tabVC "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("UITabBarController "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("AppDelegate sharedAppDelegate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("rootViewController"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("index "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" index "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" tabVC"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("viewControllers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("count"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("tabVC setSelectedIndex"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("index"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("PopUtils popToRootViewController"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br")])]),a("div",{staticClass:"language-objc line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-objc"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("popToRootViewControllerAnimated"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("BOOL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("animated "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    UITabBarController "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("tabVC "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("UITabBarController "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("AppDelegate sharedAppDelegate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("rootViewController"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("UINavigationController "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("navVC "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" tabVC"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("viewControllers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("navVC"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("viewControllers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("count "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("navVC popToRootViewControllerAnimated"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("animated"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("navVC setNavigationBarHidden"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("NO animated"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("NO"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br")])]),a("p",[t._v("发现并不是此处的问题，因为[UCYWebViewController viewDidAppear:NO]方法已经执行，购物车页面已经显示。")]),t._v(" "),a("blockquote",[a("p",[t._v("小技巧：之前在写光明都市菜园内存优化的文章中提到过的拦截器（囧，想针对这个拦截器写一篇文章，一直没来得及写），在拦截器中对Controller Life Cycle方法进行hook并进行Method Swizzling，在swizzling方法中做日志打印，可以很方便的查看所有Controller Life Cycle执行过程。")])]),t._v(" "),a("p",[t._v("第一步短点调试无果，Log日志输出又没有具体的内容可以查看，对于EXC_BAD_ACCESS看来还是要要启用僵尸对象来进行调试才行，按住option键，点击Xcode的Run按钮，打开如下界面，勾选 Enable Zombie Objects。")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://file.aioser.com/QQ20160401-0@2x.png",alt:"启用僵尸对象"}})]),t._v(" "),a("p",[t._v("重新运行，按照之前的操作重新操作一遍，这次在log中便可以看到具体是什么原因到导致的问题。")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://file.aioser.com/QQ20160401-1@2x.png",alt:"Crash原因"}})]),t._v(" "),a("p",[t._v("原来问题出现在视频播放器这里，但是让人费解的是，视频详情的Controller正常dealloc，Controller中的播放器容器FMGVideoPlayView也正常dealloc，怎么就出现FMGVideoPlayView retain呢？")]),t._v(" "),a("h3",{attrs:{id:"fmgvideoplayview-exc-bad-access解决"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#fmgvideoplayview-exc-bad-access解决"}},[t._v("#")]),t._v(" FMGVideoPlayView EXC_BAD_ACCESS解决")]),t._v(" "),a("p",[t._v("仔细查看源码，在视频播放完成或者页面返回的时候，需要对Player进行清理处理，其中Player有Notification监听，KVO的Observer监听等。猜想，是不是因为FMGVideoPlayView在dealloc后，这些监听并没有移除导致的EXC_BAD_ACCESS。")]),t._v(" "),a("p",[t._v("FMGVideoPlayView代码中写有removePlayer方法专门处理进行监听的移除，player的的释放等操作。")]),t._v(" "),a("div",{staticClass:"language-objc line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-objc"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("removePlayer "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("self")]),t._v(" removeObserverFromPlayerItem"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("self")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("player"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("currentItem"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("self")]),t._v(" removeNotification"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("self")]),t._v(" removeShowTimer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("self")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("player pause"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("self")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("danmakuView pauseAnimation"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("self")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("player"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("currentItem cancelPendingSeeks"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("self")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("player"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("currentItem"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("asset cancelLoading"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("self")]),t._v(" removePlaybackTimeObserver"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("self")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("currentItem "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" nil"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("self")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("player "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" nil"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br")])]),a("p",[t._v("所以尝试在FMGVideoPlayView的dealloc方法中进行removePlayer，重新运行。问题得到解决。")]),t._v(" "),a("h3",{attrs:{id:"原因"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#原因"}},[t._v("#")]),t._v(" 原因")]),t._v(" "),a("p",[t._v("从上面的解决过程可以看出，在FMGVideoPlayView被dealloc的时候，其中注册的Notification和KVO均没有被正常remove掉，监听依然被注册着。")]),t._v(" "),a("p",[t._v("所以问题来了：")]),t._v(" "),a("ul",[a("li",[a("p",[a("strong",[t._v("在ARC中我们需要移除KVO的observer吗？")])]),t._v(" "),a("p",[t._v("在Apple官方文档中介绍"),a("a",{attrs:{href:"https://developer.apple.com/library/mac/documentation/Cocoa/Reference/Foundation/Protocols/NSKeyValueObserving_Protocol/index.html#//apple_ref/occ/instm/NSObject/removeObserver:forKeyPath:context:",target:"_blank",rel:"noopener noreferrer"}},[t._v("removeObserver:forKeyPath:context:"),a("OutboundLink")],1),t._v("的时候，其中有一段文字为：")]),t._v(" "),a("blockquote",[a("p",[t._v("Be sure to invoke this method (or "),a("code",[t._v("removeObserver:forKeyPath:")]),t._v(") before any object specified in"),a("code",[t._v("addObserver:forKeyPath:options:context:")]),t._v(" is deallocated.")])]),t._v(" "),a("p",[t._v("也就是说在我们dealloc对象之前必须要移除KVO的observer.")]),t._v(" "),a("blockquote",[a("p",[t._v("Yes, ARC only relieves you from calling retain/release. You still have to call setDelegate:nil, and removeObservers.  In your dealloc method, you don't need to call [super dealloc] it is taken care of for you by the runtime.")])]),t._v(" "),a("p",[t._v("在ARC模式下，在dealloc方法中需要removeObservers。")])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("ARC给一个对象添加了observe会导致循环引用吗？")])]),t._v(" "),a("p",[a("a",{attrs:{href:"http://stackoverflow.com/questions/8122976/objective-c-automatic-reference-counting-arc-and-key-value-observing",target:"_blank",rel:"noopener noreferrer"}},[t._v("Objective-C Automatic Reference Counting (ARC) and Key-Value Observing"),a("OutboundLink")],1)]),t._v(" "),a("blockquote",[a("p",[t._v("You need to call "),a("code",[t._v("removeObserver")]),t._v(", ARC only automates retain counts. "),a("code",[t._v("removeObserver")]),t._v(" does not impact the retain count")])]),t._v(" "),a("p",[t._v("ARC只会自动处理引用计数器，调用removeObserver并不会影响引用计数器。")])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("当要通知的对象已经nil了,这个通知会自动remove吗？")])]),t._v(" "),a("p",[a("a",{attrs:{href:"http://stackoverflow.com/questions/11544690/will-observers-automatically-removed-when-observers-become-nil",target:"_blank",rel:"noopener noreferrer"}},[t._v("Will observers automatically removed when observers become nil?"),a("OutboundLink")],1)]),t._v(" "),a("blockquote",[a("p",[t._v("Observers are not removed automatically. From the NSNotificationCenter Class Reference:")]),t._v(" "),a("p",[a("strong",[t._v("Important")]),t._v(": The notification center does not retain its observers, therefore, you must ensure that you unregister observers (using removeObserver: or removeObserver:name:object:) before they are deallocated. (If you don't, you will generate a runtime error if the center sends a message to a freed object.)")]),t._v(" "),a("p",[t._v("You should therefore call")]),t._v(" "),a("div",{staticClass:"language-objc line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-objc"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("NSNotificationCenter defaultCenter"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" removeObserver"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("self")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[t._v("in your "),a("code",[t._v("dealloc")]),t._v(" method if you are not 100% sure that the observer was not removed previously.")])]),t._v(" "),a("p",[t._v("观察者并不会自动移除，通知中心并不会retain observer，因此，你必须保证在dealloc之前进行removerObserve，前面也说过了。")])])]),t._v(" "),a("p",[a("strong",[t._v("最后附上Apple文档链接"),a("a",{attrs:{href:"https://developer.apple.com/library/mac/documentation/Cocoa/Reference/Foundation/Protocols/NSKeyValueObserving_Protocol/index.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("NSKeyValueObserving"),a("OutboundLink")],1),t._v("感觉很有必要进去仔细看下。")])])])}),[],!1,null,null,null);e.default=n.exports}}]);
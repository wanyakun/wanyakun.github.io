(window.webpackJsonp=window.webpackJsonp||[]).push([[52],{694:function(s,t,n){"use strict";n.r(t);var a=n(4),e=Object(a.a)({},(function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("p",[s._v("有一段时间没有关注公司App的启动状况了，今天公司PM反馈App启动速度非常慢，让帮忙协助排查下问题。这里记录下整个过程。并涉及到一些大致的优化方法。")]),s._v(" "),n("blockquote",[n("p",[s._v("以下所有数据均采用iPhone 6 plus测试，性能好的手机会更快，比如iPHone X MAX")])]),s._v(" "),n("h2",{attrs:{id:"应用启动流程"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#应用启动流程"}},[s._v("#")]),s._v(" 应用启动流程")]),s._v(" "),n("p",[s._v("iOS应用的启动可分为pre-main阶段和main()阶段，其中系统做的事情依次是：")]),s._v(" "),n("ol",[n("li",[n("p",[s._v("pre-main阶段")]),s._v(" "),n("p",[s._v("1.1. 加载应用的可执行文件"),n("br"),s._v("\n1.2. 加载动态链接库加载器dyld(dynamic loader)"),n("br"),s._v("\n1.3. dyld递归加载应用所有依赖的dylib(dynamic library 动态链接库)")])]),s._v(" "),n("li",[n("p",[s._v("main()阶段")]),s._v(" "),n("p",[s._v("2.1. dyld调用main()"),n("br"),s._v("\n2.2. 调用UIApplicationMain()"),n("br"),s._v("\n2.3. 调用applicationWillFinishLaunching"),n("br"),s._v("\n2.4. 调用didFinishLaunchingWithOptions")])])]),s._v(" "),n("h2",{attrs:{id:"启动时间计算"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#启动时间计算"}},[s._v("#")]),s._v(" 启动时间计算")]),s._v(" "),n("p",[s._v("App总启动时间 = pre-main()加载时间 + main()加载时间")]),s._v(" "),n("h2",{attrs:{id:"启动耗时的测量"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#启动耗时的测量"}},[s._v("#")]),s._v(" 启动耗时的测量")]),s._v(" "),n("h3",{attrs:{id:"pre-main"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#pre-main"}},[s._v("#")]),s._v(" pre-main")]),s._v(" "),n("p",[s._v("对于pre-main阶段，Apple提供了一种测量方法，在 Xcode 中 Edit scheme -> Run -> Auguments 将环境变量DYLD_PRINT_STATISTICS 设为1 ：")]),s._v(" "),n("p",[n("img",{attrs:{src:"/assets/img/2018/launch-statistics.jpg",alt:"DYLD_PRINT_STATISTICS"}})]),s._v(" "),n("p",[s._v("第一次冷启动")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("Total pre-main time: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.4")]),s._v(" seconds "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100.0")]),s._v("%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n         dylib loading time: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.0")]),s._v(" seconds "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("68.5")]),s._v("%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        rebase/binding time: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("269.59")]),s._v(" milliseconds "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("6.1")]),s._v("%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            ObjC setup time: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("644.33")]),s._v(" milliseconds "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("14.6")]),s._v("%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n           initializer time: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("473.18")]),s._v(" milliseconds "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.7")]),s._v("%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n           slowest intializers "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v("\n             libSystem.B.dylib "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("32.77")]),s._v(" milliseconds "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.7")]),s._v("%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    libMainThreadChecker.dylib "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("134.16")]),s._v(" milliseconds "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.0")]),s._v("%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("p",[s._v("第二次热启动")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v(" Total pre-main time: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.1")]),s._v(" seconds "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100.0")]),s._v("%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n         dylib loading time: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.9")]),s._v(" seconds "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("72.5")]),s._v("%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        rebase/binding time: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("253.23")]),s._v(" milliseconds "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("6.1")]),s._v("%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            ObjC setup time: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("430.37")]),s._v(" milliseconds "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.4")]),s._v("%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n           initializer time: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("447.22")]),s._v(" milliseconds "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.8")]),s._v("%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n           slowest intializers "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v("\n             libSystem.B.dylib "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("33.03")]),s._v(" milliseconds "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.8")]),s._v("%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    libMainThreadChecker.dylib "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("84.15")]),s._v(" milliseconds "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.0")]),s._v("%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                  AFNetworking "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("106.04")]),s._v(" milliseconds "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.5")]),s._v("%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("p",[s._v("第三次热启动")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("Total pre-main time: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.7")]),s._v(" seconds "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100.0")]),s._v("%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n         dylib loading time: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.9")]),s._v(" seconds "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("78.2")]),s._v("%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        rebase/binding time: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("232.80")]),s._v(" milliseconds "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("6.1")]),s._v("%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            ObjC setup time: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("204.22")]),s._v(" milliseconds "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.4")]),s._v("%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n           initializer time: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("379.50")]),s._v(" milliseconds "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.1")]),s._v("%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n           slowest intializers "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v("\n             libSystem.B.dylib "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("27.56")]),s._v(" milliseconds "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.7")]),s._v("%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                  AFNetworking "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("122.75")]),s._v(" milliseconds "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.2")]),s._v("%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("p",[s._v("还有个方法获取更详细的时间，只需要将环境变量DYLD_PRINT_STATISTICS_DETAILS设置为1就可以了。")]),s._v(" "),n("h3",{attrs:{id:"main"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#main"}},[s._v("#")]),s._v(" main")]),s._v(" "),n("p",[s._v("对于main阶段的启动时间测量，可以在Application组件中新建一个AppStartConstants.h文件声明全局变量"),n("code",[s._v("CFAbsoluteTime MainTime;")]),s._v("（也可以在其他地方，只要能够被引入即可）。")]),s._v(" "),n("ol",[n("li",[n("p",[s._v("在main.m文件中引入并获取当前时间：")]),s._v(" "),n("div",{staticClass:"language-Objective-C line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("extern CFAbsoluteTime MainTime;\n\nint main(int argc, char * argv[])\n{\n    @autoreleasepool {\n        MainTime = CFAbsoluteTimeGetCurrent();\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])])]),s._v(" "),n("li",[n("p",[s._v("在"),n("code",[s._v("- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions")]),s._v("函数最后获取当前时间并计算差值")]),s._v(" "),n("div",{staticClass:"language-Objective-C line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('extern CFAbsoluteTime MainTime;\n\n- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions{\n\t// 其他代码\n    double launchTime = (CFAbsoluteTimeGetCurrent() - MainTime);\n    NSLog(@"Total main time: %.2f second", launchTime);\n    return YES;\n}\n\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("p",[s._v("第一次冷启动获取到的启动时间：Total main time: 7.32 second"),n("br"),s._v("\n第二次热启动获取到的启动时间：Total main time: 6.52 second"),n("br"),s._v("\n第三次热启动获取到的启动时间：Total main time: 6.28 second")])])]),s._v(" "),n("p",[s._v("简单写了个记录时间的工具，后面所有时间都是基于这个工具记录和输出的，代码如下：")]),s._v(" "),n("div",{staticClass:"language-objc line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-objc"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//  AppStartTime.h")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//  Created by wanyakun on 2018/11/2.")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token macro property"}},[n("span",{pre:!0,attrs:{class:"token directive-hash"}},[s._v("#")]),n("span",{pre:!0,attrs:{class:"token directive keyword"}},[s._v("import")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token expression"}},[n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("Foundation"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("Foundation"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("h"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")])])]),s._v("\n\nNS_ASSUME_NONNULL_BEGIN\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("@interface")]),s._v(" AppStartTime "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" NSObject\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("@property")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("nonatomic"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" assign"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" CFAbsoluteTime mainTime"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("instancetype"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("shareInstance"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("logTimeWithMessage"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("NSString "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("message"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("printLogMessage"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("@end")]),s._v("\n\nNS_ASSUME_NONNULL_END\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br")])]),n("div",{staticClass:"language-objc line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-objc"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//  AppStartTime.m")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//  Created by wanyakun on 2018/11/2.")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token macro property"}},[n("span",{pre:!0,attrs:{class:"token directive-hash"}},[s._v("#")]),n("span",{pre:!0,attrs:{class:"token directive keyword"}},[s._v("import")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"AppStartTime.h"')])]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("@interface")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("AppStartTime")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("@property")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("nonatomic"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" assign"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" CFAbsoluteTime lastTime"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("@property")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("nonatomic"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" strong"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" NSMutableArray "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("messageArray"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("@end")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("@implementation")]),s._v(" AppStartTime\n\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("instancetype"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("shareInstance "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" AppStartTime "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("instance "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" nil"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" dispatch_once_t onceToken"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("dispatch_once")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("onceToken"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("^")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        instance "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("AppStartTime alloc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" init"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" instance"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("instancetype"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("init "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("self")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("super")]),s._v(" init"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        _mainTime "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("CFAbsoluteTimeGetCurrent")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        _lastTime "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" _mainTime"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        _messageArray "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("NSMutableArray arrayWithCapacity"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("self")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("logTimeWithMessage"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("NSString "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("message "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("AppStartTime shareInstance"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" logTimeWithMessage"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("message"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("logTimeWithMessage"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("NSString "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("message "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    CFAbsoluteTime current "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("CFAbsoluteTimeGetCurrent")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    CFTimeInterval duration "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" current "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" _lastTime"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    NSString "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("startMessage "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" nil"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("duration "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        startMessage "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("NSString stringWithFormat"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('@"%@ time: %.1f seconds"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" message"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" duration"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        startMessage "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("NSString stringWithFormat"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('@"%@ time: %.2f milliseconds"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" message"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" duration"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("_messageArray addObject"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("startMessage"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    _lastTime "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" current"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("printLogMessage "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("AppStartTime shareInstance"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" printLogMessage"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("printLogMessage "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    \n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("double")]),s._v(" launchTime "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("CFAbsoluteTimeGetCurrent")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("self")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("mainTime"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("NSLog")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('@"Total main time: %.4f second"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" launchTime"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    \n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("_messageArray enumerateObjectsUsingBlock"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("^")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id  _Nonnull obj"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" NSUInteger idx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" BOOL "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" _Nonnull stop"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("NSLog")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('@"%@"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" obj"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  \n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("@end")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br")])]),n("h2",{attrs:{id:"启动时间优化"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#启动时间优化"}},[s._v("#")]),s._v(" 启动时间优化")]),s._v(" "),n("h3",{attrs:{id:"pre-main优化"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#pre-main优化"}},[s._v("#")]),s._v(" pre-main优化")]),s._v(" "),n("p",[s._v("看第一次冷启动的时间如下：")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("Total pre-main time: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.4")]),s._v(" seconds "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100.0")]),s._v("%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n         dylib loading time: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.0")]),s._v(" seconds "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("68.5")]),s._v("%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        rebase/binding time: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("269.59")]),s._v(" milliseconds "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("6.1")]),s._v("%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            ObjC setup time: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("644.33")]),s._v(" milliseconds "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("14.6")]),s._v("%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n           initializer time: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("473.18")]),s._v(" milliseconds "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.7")]),s._v("%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n           slowest intializers "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v("\n             libSystem.B.dylib "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("32.77")]),s._v(" milliseconds "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.7")]),s._v("%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    libMainThreadChecker.dylib "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("134.16")]),s._v(" milliseconds "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.0")]),s._v("%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("ol",[n("li",[n("p",[s._v("dylib loading")]),s._v(" "),n("blockquote",[n("p",[s._v("这一阶段dyld会分析应用依赖的dylib，找到其mach-o文件，打开和读取这些文件并验证其有效性，接着会找到代码签名注册到内核，最后对dylib的每一个segment调用mmap()。一般情况下，iOS应用会加载100-400个dylibs，其中大部分是系统库，这部分dylib的加载系统已经做了优化。")])]),s._v(" "),n("p",[s._v("所以，依赖的dylib越少越好。在这一步，我们可以做的优化有：")]),s._v(" "),n("ul",[n("li",[s._v("尽量不使用内嵌(embedded)的dylib，加载内嵌dylib性能开销较大")]),s._v(" "),n("li",[s._v("合并已有的dylib和使用静态库(static archives)，减少dylib的使用个数")])]),s._v(" "),n("p",[s._v("由于App中有一百多个组件，而且都是动态Framework，所以会出现 dylib loading time: 3.0 seconds (68.5%)\n所以尽量不使用内嵌的dylib是不太现实的。我们能做的是对现有组件进行分析，尽可能减少组件个数。")]),s._v(" "),n("ul",[n("li",[s._v("去掉没有使用的系统lib")]),s._v(" "),n("li",[s._v("去掉已经废弃的组件、类库")]),s._v(" "),n("li",[s._v("功能重复的组件，只保留一个，比如json等第三方组件（swift和Objective-C的）")]),s._v(" "),n("li",[s._v("合并功能类似的组件、分类，比如Utils等")]),s._v(" "),n("li",[s._v("优化现有的组件，比如RN只有一个风险测评在使用，如果未来一段时间不打算使用，可以降级到H5，RN组件依赖的部分也会相应减少，考虑MVVM用到的RX组件是否继续使用")])])]),s._v(" "),n("li",[n("p",[s._v("rebase/binding")]),s._v(" "),n("blockquote",[n("p",[s._v("在dylib的加载过程中，系统为了安全考虑，引入了ASLR(Address Space Layout Randomization)技术和代码签名。由于ASLR的存在，镜像(Image，包括可执行文件、dylib和bundle)会在随机的地址上加载，和之前指针指向的地址(preferred_address)会有一个偏差(slide)，dyld需要修正这个偏差，来指向正确的地址。Rebase在前，Bind在后，Rebase做的是将镜像读入内存，修正镜像内部的指针，性能消耗主要在IO。Bind做的是查询符号表，设置指向镜像外部的指针，性能消耗主要在CPU计算。")])]),s._v(" "),n("p",[s._v("所以，指针数量越少越好。在这一步，我们可以做的优化有：")]),s._v(" "),n("ul",[n("li",[s._v("减少ObjC类(class)、方法(selector)、分类(category)的数量")]),s._v(" "),n("li",[s._v("减少C++虚函数的的数量(创建虚函数表有开销)")]),s._v(" "),n("li",[s._v("使用Swift structs(内部做了优化，符号数量更少)")])])]),s._v(" "),n("li",[n("p",[s._v("ObjC setup")]),s._v(" "),n("blockquote",[n("p",[s._v("大部分ObjC初始化工作已经在Rebase/Bind阶段做完了，这一步dyld会注册所有声明过的ObjC类，将分类插入到类的方法列表里，再检查每个selector的唯一性。")])]),s._v(" "),n("p",[s._v("在这一步倒没什么优化可做的，Rebase/Bind阶段优化好了，这一步的耗时也会减少。")])]),s._v(" "),n("li",[n("p",[s._v("initializer")]),s._v(" "),n("blockquote",[n("p",[s._v("到了这一阶段，dyld开始运行程序的初始化函数，调用每个Objc类和分类的+load方法，调用C/C++ 中的构造器函数(用__attribute__((constructor))修饰的函数)，和创建非基本类型的C++静态全局变量。Initializers阶段执行完后，dyld开始调用main()函数。")])]),s._v(" "),n("p",[s._v("在这一步，我们可以做的优化有：")]),s._v(" "),n("ul",[n("li",[s._v("少在类的+load方法里做事情，尽量把这些事情推迟到+initiailize (目前有容器类防护)")]),s._v(" "),n("li",[s._v("减少构造器函数个数，在构造器函数里少做些事情 (目前注册路由、Handler和神策埋点)")]),s._v(" "),n("li",[s._v("减少C++静态全局变量的个数")])])])]),s._v(" "),n("p",[s._v("总结执行方法：")]),s._v(" "),n("ul",[n("li",[s._v("排查无用的dylib，移除不再使用的lib")]),s._v(" "),n("li",[s._v("删除无用的组件、类库，合并重复的文件、分类，移除功能重复的第三方库或者通用业务组")]),s._v(" "),n("li",[s._v("梳理各个类的+load方法，将多个类中+load方法做的事延迟到+initiailize里去做。")])]),s._v(" "),n("p",[s._v("TODO: 记录优化后的耗时，做对比")]),s._v(" "),n("h3",{attrs:{id:"main优化"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#main优化"}},[s._v("#")]),s._v(" main优化")]),s._v(" "),n("blockquote",[n("p",[s._v("这一阶段的优化主要是减少"),n("code",[s._v("didFinishLaunchingWithOptions")]),s._v("方法里的工作，在"),n("code",[s._v("didFinishLaunchingWithOptions")]),s._v("方法里，我们会创建应用的window，指定其rootViewController，调用window的makeKeyAndVisible方法让其可见。由于业务需要，我们会初始化各个二方/三方库，检查是否需要显示引导页、是否需要登录、是否有新版本等，由于历史原因，这里的代码容易变得比较庞大，启动耗时难以控制。")])]),s._v(" "),n("p",[s._v("所以，满足业务需要的前提下，"),n("code",[s._v("didFinishLaunchingWithOptions")]),s._v("在主线程里做的事情越少越好。在这一步，我们可以做的优化有：")]),s._v(" "),n("ul",[n("li",[s._v("梳理各个二方/三方库，找到可以延迟加载的库，做延迟加载处理，比如放到MainTabBarController的viewDidAppear方法里。")]),s._v(" "),n("li",[s._v("梳理业务逻辑，把可以延迟执行的逻辑，做延迟执行处理。比如检查新版本、注册推送通知等逻辑。")]),s._v(" "),n("li",[s._v("避免复杂/多余的计算。")]),s._v(" "),n("li",[s._v("避免在首页控制器的viewDidLoad和viewWillAppear做太多事情，这2个方法执行完，首页控制器才能显示，部分可以延迟创建的视图应做延迟创建/懒加载处理。")])]),s._v(" "),n("h2",{attrs:{id:"实践"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#实践"}},[s._v("#")]),s._v(" 实践")]),s._v(" "),n("p",[s._v("App完整的启动时间（main阶段时间为总耗时，每一步的耗时通过减去上一步就可以算出）")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("\tTotal pre-main time: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.0")]),s._v(" seconds "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100.0")]),s._v("%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n         dylib loading time: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.1")]),s._v(" seconds "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("77.7")]),s._v("%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        rebase/binding time: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("244.99")]),s._v(" milliseconds "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("6.0")]),s._v("%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            ObjC setup time: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("231.28")]),s._v(" milliseconds "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.7")]),s._v("%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n           initializer time: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("422.69")]),s._v(" milliseconds "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.4")]),s._v("%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("-10-31 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":20:57.832445+0800 Lender"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("16596")]),s._v(":1060700"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" didFinishLaunch time: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.31")]),s._v(" second\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("-10-31 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":20:57.834161+0800 Lender"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("16596")]),s._v(":1060700"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" window create time: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.31")]),s._v(" second\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("-10-31 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":20:57.844925+0800 Lender"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("16596")]),s._v(":1060700"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" AppConfigBusiness time: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.32")]),s._v(" second\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("-10-31 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":20:57.896577+0800 Lender"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("16596")]),s._v(":1060700"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" AppConfigNetworking time: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.37")]),s._v(" second\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("-10-31 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":20:57.901165+0800 Lender"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("16596")]),s._v(":1060700"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" AppConfigBootingProtection time: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.38")]),s._v(" second\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("16596")]),s._v(":1060700"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" AppConfigRouter time: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.38")]),s._v(" second\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("-10-31 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":20:57.963292+0800 Lender"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("16596")]),s._v(":1060700"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" LoadLocalToken time: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.44")]),s._v(" second\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("-10-31 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":20:57.963436+0800 Lender"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("16596")]),s._v(":1060700"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" DataCompatibility time: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.44")]),s._v(" second\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("-10-31 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":20:58.320243+0800 Lender"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("16596")]),s._v(":1060700"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" AppDelegateNotificationsManager time: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.80")]),s._v(" second\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("-10-31 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":20:58.334090+0800 Lender"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("16596")]),s._v(":1060700"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" BIZConfigCenter checkUpdate time: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.81")]),s._v(" second\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("-10-31 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":20:58.338521+0800 Lender"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("16596")]),s._v(":1060700"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" BLLBSManager time: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.81")]),s._v(" second\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("-10-31 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":20:58.340121+0800 Lender"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("16596")]),s._v(":1060700"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" LCLocationManager time: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.82")]),s._v(" second\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("-10-31 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":20:58.648829+0800 Lender"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("16596")]),s._v(":1060700"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" AppConfigShenCe time: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.12")]),s._v(" second\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("-10-31 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":20:58.846310+0800 Lender"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("16596")]),s._v(":1060700"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" AppConfigUMTG time: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.32")]),s._v(" second\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("-10-31 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":21:03.565177+0800 Lender"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("16596")]),s._v(":1060700"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" UMShareTool configUMShare time: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("6.04")]),s._v(" second\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("-10-31 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":21:03.566030+0800 Lender"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("16596")]),s._v(":1060700"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" BIZPush start time: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("6.04")]),s._v(" second\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("-10-31 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":21:03.566481+0800 Lender"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("16596")]),s._v(":1060700"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" AppConfigTingYun time: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("6.04")]),s._v(" second\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("-10-31 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":21:03.587389+0800 Lender"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("16596")]),s._v(":1060700"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" ConfigAPM time: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("6.06")]),s._v(" second\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("-10-31 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":21:03.587538+0800 Lender"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("16596")]),s._v(":1060700"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" AppConfigBanner time: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("6.06")]),s._v(" second\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("-10-31 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":21:03.612676+0800 Lender"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("16596")]),s._v(":1060700"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" SaveUserAgent time: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("6.09")]),s._v(" second\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("-10-31 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":21:03.616083+0800 Lender"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("16596")]),s._v(":1060700"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Config BeeHive time: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("6.09")]),s._v(" second\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("-10-31 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":21:03.619002+0800 Lender"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("16596")]),s._v(":1060700"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" super didFinishLaunchingWithOptions time: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("6.09")]),s._v(" second\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("-10-31 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":21:03.781076+0800 Lender"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("16596")]),s._v(":1060700"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" config root vc time: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("6.26")]),s._v(" second\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("-10-31 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":21:03.794603+0800 Lender"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("16596")]),s._v(":1060700"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" ShowAdvertisement time: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("6.27")]),s._v(" second\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("-10-31 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":21:03.797242+0800 Lender"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("16596")]),s._v(":1060700"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" AppConfigInfoCollect time: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("6.27")]),s._v(" second\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("-10-31 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":21:03.803755+0800 Lender"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("16596")]),s._v(":1060700"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" UIWebView thread time: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("6.28")]),s._v(" second\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("-10-31 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":21:03.803853+0800 Lender"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("16596")]),s._v(":1060700"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Total main time: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("6.28")]),s._v(" second\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br")])]),n("h3",{attrs:{id:"pre-main阶段优化"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#pre-main阶段优化"}},[s._v("#")]),s._v(" pre-main阶段优化")]),s._v(" "),n("ol",[n("li",[s._v("要开发人员配合，主要靠减少组件、合并功能重复代码，删除无用代码来做。")]),s._v(" "),n("li",[s._v("所有Framework动态库转static library静态库。"),n("code",[s._v("dylib loading time: 3.1 seconds (77.7%)")]),s._v(" 这一部分基本上可以完全优化掉")]),s._v(" "),n("li",[s._v("二进制重排。目的是减少Page Fault, 做法就是通过Clang插桩获取到启动到首页加载完成所执行的函数，然后写入到order文件，最后壳工程配置下order文件。具体做法详见："),n("a",{attrs:{href:"https://www.jianshu.com/p/3f9ed86a45cb",target:"_blank",rel:"noopener noreferrer"}},[s._v("ios启动优化：二进制重排"),n("OutboundLink")],1)])]),s._v(" "),n("p",[s._v("下面为优化后的效果：")]),s._v(" "),n("p",[n("img",{attrs:{src:"/assets/img/2018/launch-premain.jpg",alt:"pre-main"}})]),s._v(" "),n("h3",{attrs:{id:"main阶段优化"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#main阶段优化"}},[s._v("#")]),s._v(" main阶段优化")]),s._v(" "),n("p",[s._v("从中可以看出UMShareTool configUMShare time占用了将近5s的时间，而且是非启动必须配置的业务，而main函数中Debug组件启动时间也较长大概0.3s。超过100ms的配置都需要考虑优化。")]),s._v(" "),n("p",[s._v("我们建立一个队列，将一些不需要必须在主线程中启动的配置放到队列中中去配置（比如BootingProtection、友盟、TalkingData、友盟分享、设置UserAgent）。")]),s._v(" "),n("p",[s._v("另外删除webkit启动的代码，因为在设置UserAgent中已经创建UIWebView实例，启动了webkit")]),s._v(" "),n("p",[n("strong",[s._v("注意：听云要去必须在主线程中启动，神策目前不确定是否需要放到队列中（暂时先放到了队列中）")])]),s._v(" "),n("p",[s._v("main时间初步优化后的结果（优化了时间输出格式，每一步为实际用时）：")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("-10-31 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(":59:27.987630+0800 Lender"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("19074")]),s._v(":1207484"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Total main time: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.02")]),s._v(" second\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("-10-31 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(":59:27.988138+0800 Lender"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("19074")]),s._v(":1207484"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" didFinishLaunch time: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("108.54")]),s._v(" milliseconds\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("-10-31 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(":59:27.988450+0800 Lender"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("19074")]),s._v(":1207484"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" window create time: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.07")]),s._v(" milliseconds\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("-10-31 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(":59:27.988836+0800 Lender"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("19074")]),s._v(":1207484"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" AppConfigBusiness time: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("12.09")]),s._v(" milliseconds\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("-10-31 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(":59:27.989111+0800 Lender"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("19074")]),s._v(":1207484"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" AppConfigNetworking time: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("78.91")]),s._v(" milliseconds\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("-10-31 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(":59:27.989376+0800 Lender"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("19074")]),s._v(":1207484"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" AppConfigBootingProtection time: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.04")]),s._v(" milliseconds\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("-10-31 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(":59:27.989648+0800 Lender"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("19074")]),s._v(":1207484"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" AppConfigRouter time: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.41")]),s._v(" milliseconds\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("-10-31 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(":59:27.989894+0800 Lender"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("19074")]),s._v(":1207484"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" LoadLocalToken time: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.23")]),s._v(" milliseconds\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("-10-31 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(":59:27.990151+0800 Lender"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("19074")]),s._v(":1207484"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" DataCompatibility time: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.05")]),s._v(" milliseconds\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("-10-31 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(":59:27.990419+0800 Lender"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("19074")]),s._v(":1207484"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" AppConfigTingYun time: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("392.52")]),s._v(" milliseconds\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("-10-31 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(":59:27.990666+0800 Lender"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("19074")]),s._v(":1207484"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" AppConfigShenCe time: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.31")]),s._v(" milliseconds\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("-10-31 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(":59:27.990908+0800 Lender"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("19074")]),s._v(":1207484"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" NotificationsManager time: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("44.76")]),s._v(" milliseconds\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("-10-31 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(":59:27.991193+0800 Lender"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("19074")]),s._v(":1207484"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" BIZConfigCenter time: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("19.47")]),s._v(" milliseconds\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("-10-31 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(":59:27.991453+0800 Lender"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("19074")]),s._v(":1207484"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" BLLBSManager time: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.44")]),s._v(" milliseconds\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("-10-31 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(":59:27.991708+0800 Lender"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("19074")]),s._v(":1207484"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" LCLocationManager time: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.47")]),s._v(" milliseconds\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("-10-31 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(":59:27.991961+0800 Lender"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("19074")]),s._v(":1207484"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" AppConfigUMTG time: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.83")]),s._v(" milliseconds\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("-10-31 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(":59:27.992201+0800 Lender"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("19074")]),s._v(":1207484"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" ConfigUMShare time: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.04")]),s._v(" milliseconds\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("-10-31 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(":59:27.992409+0800 Lender"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("19074")]),s._v(":1207484"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" BIZPush start time: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.82")]),s._v(" milliseconds\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("-10-31 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(":59:27.992463+0800 Lender"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("19074")]),s._v(":1207484"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" ConfigAPM time: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("28.12")]),s._v(" milliseconds\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("-10-31 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(":59:27.992495+0800 Lender"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("19074")]),s._v(":1207484"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" AppConfigBanner time: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.18")]),s._v(" milliseconds\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("-10-31 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(":59:27.992596+0800 Lender"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("19074")]),s._v(":1207484"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Config BeeHive time: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.78")]),s._v(" milliseconds\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("-10-31 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(":59:27.992894+0800 Lender"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("19074")]),s._v(":1207484"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Super finishLaunching time: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.40")]),s._v(" milliseconds\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("-10-31 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(":59:27.992949+0800 Lender"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("19074")]),s._v(":1207484"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" config root vc time: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("268.16")]),s._v(" milliseconds\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("-10-31 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(":59:27.993012+0800 Lender"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("19074")]),s._v(":1207484"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" ShowAdvertisement time: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("47.51")]),s._v(" milliseconds\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("-10-31 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(":59:27.993153+0800 Lender"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("19074")]),s._v(":1207484"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" AppConfigInfoCollect time: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.32")]),s._v(" milliseconds\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br")])]),n("p",[s._v("目前main阶段只有听云和RootViewController 的创建用时比较长，听云必须在主线程启动这个没办法优化， RootViewController 要到对应的组件再做优化。可以看到热启动main阶段已经做到1秒左右。"),n("br"),s._v("\n其实main阶段还有很多业务组件的初始化可以优化，需要深入到每个业务组件中去优化，后续可以建立组件准入机制，将其影响到App启动的时间作为一项衡量指标，超过100毫秒就需要在集成的时候做告警。")]),s._v(" "),n("p",[n("strong",[s._v("至此App整体启动速度pre-main+main阶段在1.6s左右")])])])}),[],!1,null,null,null);t.default=e.exports}}]);